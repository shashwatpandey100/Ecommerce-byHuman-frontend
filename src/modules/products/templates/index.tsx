import { Region } from "@medusajs/medusa"
import { PricedProduct } from "@medusajs/medusa/dist/types/pricing"
import React, { Suspense } from "react"

import ImageGallery from "@modules/products/components/image-gallery"
import ProductActions from "@modules/products/components/product-actions"
import ProductOnboardingCta from "@modules/products/components/product-onboarding-cta"
import ProductTabs from "@modules/products/components/product-tabs"
import RelatedProducts from "@modules/products/components/related-products"
import ProductInfo from "@modules/products/templates/product-info"
import SkeletonRelatedProducts from "@modules/skeletons/templates/skeleton-related-products"
import { notFound } from "next/navigation"
import ProductActionsWrapper from "./product-actions-wrapper"

type ProductTemplateProps = {
  product: PricedProduct
  region: Region
  countryCode: string
}

const ProductTemplate: React.FC<ProductTemplateProps> = ({
  product,
  region,
  countryCode,
}) => {
  if (!product || !product.id) {
    return notFound()
  }

  return (
    <>
      <div
        className="flex flex-col small:flex-row small:items-start relative bg-[#fbf7f45a]"
        data-testid="product-container"
      >
        <div className="block w-full md:w-[800px] md:overflow-hidden relative md:sticky md:top-[60px]">
          <ImageGallery images={product?.images || []} />
        </div>
        <div className="flex flex-col w-full md:w-[calc(100vw-800px)] px-6 gap-y-12">
          <div className="flex flex-col w-full pt-8 gap-y-6">
            <ProductInfo product={product} />
          </div>
          <ProductOnboardingCta />
          <Suspense
            fallback={
              <ProductActions
                disabled={true}
                product={product}
                region={region}
              />
            }
          >
            <ProductActionsWrapper id={product.id} region={region} />
          </Suspense>
          <div className="w-full h-[150px] -mb-6 bg-[#fff6ee] grid grid-cols-3 gap-3">
            <div className="flex flex-col items-center justify-center gap-3">
              <svg
                className="max-h-[40px] opacity-80 text-red-950"
                xmlns="http://www.w3.org/2000/svg"
                shapeRendering="geometricPrecision"
                textRendering="geometricPrecision"
                imageRendering="optimizeQuality"
                fillRule="evenodd"
                clipRule="evenodd"
                viewBox="0 0 512 364.44"
              >
                <path
                  fillRule="nonzero"
                  d="m4.78 262.21 142.65-161.4a8.712 8.712 0 0 1 6.53-2.94h29.15l3.04 17.48h-28.29L30.18 259.82h461.08L458.1 115.35H350.5l-4.59-17.5 119.14-.01c4.38 0 8 3.21 8.65 7.4l37.06 161.39c1.07 4.7-1.87 9.39-6.57 10.46-.65.15-1.31.22-1.95.22l-491.44.02c-4.84 0-8.76-3.92-8.76-8.75 0-2.51 1.06-4.77 2.74-6.37zM226.9 38.89c-15.89 28.28-4.97 64.44 5.97 100.58 9.36 30.93 18.72 61.87 13.15 90.9-.96 5.02-5.81 8.31-10.83 7.35-5.01-.96-8.3-5.81-7.34-10.82 4.7-24.51-4.01-53.3-12.71-82.07-12.04-39.79-24.07-79.59-4.64-114.48l-15.35 8.06c-4.5 2.35-10.06.6-12.41-3.9-2.35-4.5-.6-10.06 3.9-12.41l40.14-21.05c4.5-2.35 10.06-.61 12.41 3.89.45.86.75 1.77.91 2.68l7.61 43.01c.88 5.02-2.49 9.8-7.5 10.68-5.02.88-9.8-2.49-10.68-7.5l-2.63-14.92zm110.83 0c-15.78 27.98-5.15 62.7 5.69 98.05 10.27 33.5 20.7 67.54 11.62 100.39-1.36 4.91-6.45 7.8-11.37 6.44-4.91-1.36-7.8-6.45-6.44-11.37 7.64-27.65-1.99-59.09-11.48-90.03-11.97-39.07-23.72-77.45-4.42-112.01l-15.35 8.05c-4.5 2.35-10.06.6-12.41-3.9-2.35-4.5-.61-10.06 3.9-12.41l40.14-21.05c4.5-2.35 10.06-.61 12.41 3.89.45.86.75 1.77.91 2.68l7.6 43.01c.88 5.02-2.48 9.8-7.5 10.68-5.01.88-9.8-2.49-10.67-7.5l-2.63-14.92zm-25.44 316.35a9.225 9.225 0 0 1-9.26 9.19c-5.1-.01-9.21-4.17-9.19-9.26.03-9.6 1.46-19.16 3.66-28.67 1.26-5.42 2.79-10.87 4.47-16.33h-91.46c-2.21 6.84-4.23 13.67-5.81 20.46-1.94 8.41-3.2 16.66-3.23 24.61-.02 5.1-4.17 9.21-9.27 9.19-5.09-.01-9.21-4.17-9.19-9.26.04-9.6 1.46-19.16 3.67-28.67 1.26-5.42 2.78-10.87 4.46-16.33H8.76c-4.84 0-8.76-3.93-8.76-8.76 0-4.84 3.92-8.76 8.76-8.76h192.39c1.58-.44 3.28-.47 4.95 0h105.88c1.57-.44 3.28-.47 4.95 0h186.31c4.84 0 8.76 3.92 8.76 8.76 0 4.83-3.92 8.76-8.76 8.76h-181.9c-2.21 6.84-4.23 13.67-5.81 20.46-1.95 8.41-3.2 16.66-3.24 24.61zM234.33 97.86l60.37-.01 3.04 17.5h-58.83l-4.58-17.49z"
                />
              </svg>
              <span className="uppercase text-[0.75rem] font-[500] text-red-950">
                Breathable
              </span>
            </div>
            <div className="flex flex-col items-center justify-center gap-3">
              <svg
                className="max-h-[40px] opacity-80 text-red-950"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 112.06 122.88"
              >
                <defs></defs>
                <title>durable</title>
                <path
                  className="cls-1"
                  d="M56.73.29a127.8,127.8,0,0,0,28.76,14c8.82,2.85,17.07,4,24.68,3.26a1.52,1.52,0,0,1,1.64,1.36V19c1.36,27.42-2.89,49.42-11.89,66.39-9.52,17.94-24.32,30.25-43.36,37.41a1.49,1.49,0,0,1-1,0c-17.93-6.55-32.2-17.87-41.8-35S-.7,47.84.08,18.15a1.51,1.51,0,0,1,1.54-1.47h0a81.65,81.65,0,0,0,28.18-3.15A77.16,77.16,0,0,0,54.91.32a1.5,1.5,0,0,1,1.82,0Zm24.46,23.9A115.66,115.66,0,0,1,56,12,70.74,70.74,0,0,1,32.54,23.92,74.66,74.66,0,0,1,9.28,26.58c0,23.64,4.22,42,12.12,55.78a62.92,62.92,0,0,0,28.26,26.05L43.74,91c-.87-2.06-1.52-4-2.32-6a40.6,40.6,0,0,0-5.8-9.41A23.65,23.65,0,0,1,32.8,64.27h0c1.42,1.08,3,2.37,4.52,3.57,2.87,2.25,5.89,5,8.89,1,.57-.81,1.15-1.59,1.74-2.32a41.18,41.18,0,0,1,7.69-7.38c-3,3-4.17,8.92-2.74,16.31,1-12,3.91-21.28,18.2-19.4L69.37,52l-5.84,2.2C59,55.87,53.87,49.83,56.15,47c7.78-4.46,18.16-12.84,23.19-3.75l4.12,7.51c5.46,9.75,1.86,13.27-4.9,22.72a65.54,65.54,0,0,1-8.47,9.76c-1.59,1.49-1.33,1-.12,3l7.1,12.63A63.22,63.22,0,0,0,91.12,81.71C98.88,68,102.77,50,102.58,27.33a59.34,59.34,0,0,1-21.39-3.14ZM32.79,51.42a2.44,2.44,0,0,1,1.48-.74,2.52,2.52,0,0,1,.89.1,3.93,3.93,0,0,1,1.72,1.12,88.07,88.07,0,0,1,8.84,8.94c1.48,1.37,1.82,2.78.65,4.15l-2.12,2.37c-1.07,1.08-2.44,1-3.93-.06-6.72-5.64-14.65-8.55-7.53-15.88ZM64,26a2.74,2.74,0,0,1,.9.24c1.52.67,3.28,3.74,4,5.15.48.9,1.86,3.34,3,5.39l-9.6,3.87c-1.54-2.48-2.93-5-4.33-7.07a3.07,3.07,0,0,1-.51-3.27,7.45,7.45,0,0,1,3-2.87C61.34,27,63.15,26,64,26ZM52.64,32.41a2.83,2.83,0,0,1,.92.18,4,4,0,0,1,1.68,1.32,22.43,22.43,0,0,1,2.67,3.57c.47.74,1.5,2.34,2.57,4-3.31,1.49-7.77,2.29-7.93,6.54-1.95-2.67-3.7-5.52-5.42-7.71a3.08,3.08,0,0,1-.71-3.24c.69-1.87,4.36-4.73,6.22-4.7ZM42.4,41a2.8,2.8,0,0,1,.89.1A3.84,3.84,0,0,1,45,42.21a21.75,21.75,0,0,1,2.84,3.19C49,47,53.61,52.83,54.27,54.17A2.42,2.42,0,0,1,53.93,57l-2.72,2.64c-1.08,1.08-2.45,1-3.94-.06C43.79,56.24,40.6,52,37.8,49a2.94,2.94,0,0,1-.95-3c.46-1.72,3.81-4.89,5.55-5Z"
                />
              </svg>
              <span className="uppercase text-[0.75rem] font-[500] text-red-950">
                Durable
              </span>
            </div>
            <div className="flex flex-col items-center justify-center gap-3">
              <svg
                className="max-h-[40px] opacity-80 text-red-950"
                version="1.1"
                id="Layer_1"
                xmlns="http://www.w3.org/2000/svg"
                x="0px"
                y="0px"
                viewBox="0 0 93.271 122.881"
                enableBackground="new 0 0 93.271 122.881"
              >
                <g>
                  <path d="M44.818,2.285c3.407,14.549,7.657,23.19,12.372,30.119l-5.811,1.965c-3.438-5.249-6.626-11.488-9.431-20.215 c-5.019,15.66-11.399,23.5-18.099,31.719c-4.859,5.96-9.899,12.14-14.619,21.91c-1.02,2.101-1.85,4.279-2.42,6.55 c-0.56,2.22-0.88,4.521-0.88,6.93c0,4.919,0.88,9.459,2.629,13.629c3.553,8.437,11.232,15.955,19.68,19.449 c4.209,1.74,8.779,2.62,13.72,2.62c4.959,0,9.549-0.88,13.768-2.62c4.221-1.749,8.131-4.39,11.701-7.909 c1.234-1.22,2.361-2.482,3.379-3.784l6.301,1.377c-1.574,2.318-3.422,4.525-5.539,6.618c-4.121,4.05-8.65,7.108-13.6,9.159 c-4.961,2.05-10.301,3.08-16.01,3.08c-5.71,0-11.041-1.03-15.99-3.08c-4.93-2.04-9.45-5.1-13.569-9.159 c-4.11-4.062-7.21-8.55-9.281-13.46C1.039,92.252,0,86.941,0,81.262c0-2.91,0.379-5.699,1.06-8.39c0.67-2.64,1.64-5.18,2.84-7.66 c5.021-10.38,10.29-16.84,15.36-23.069c7.609-9.34,14.79-18.14,19.79-39.849c0.359-1.59,1.949-2.58,3.539-2.22 C43.739,0.344,44.569,1.224,44.818,2.285L44.818,2.285L44.818,2.285z M83.148,42.595c1.336,0.982,1.551,2.81,0.479,4.087 c-1.076,1.265-3.039,1.493-4.391,0.513c-5.156-3.772-8.73-1.447-12.879,1.26c-6.117,4.009-13.143,8.588-25.531,3.687 c-1.577-0.624-2.277-2.327-1.596-3.806c0.697-1.48,2.533-2.162,4.107-1.55c9.226,3.653,14.714,0.062,19.503-3.078 C69.059,39.677,74.398,36.185,83.148,42.595L83.148,42.595L83.148,42.595z M92.107,81.648c1.34,0.982,1.553,2.809,0.479,4.087 c-1.074,1.265-3.037,1.495-4.389,0.514c-5.158-3.786-8.73-1.448-12.879,1.26c-6.119,4.008-13.141,8.588-25.533,3.687 c-1.576-0.624-2.276-2.327-1.594-3.807c0.695-1.479,2.531-2.161,4.107-1.549c9.223,3.653,14.711,0.062,19.502-3.078 C78.016,78.716,83.357,75.224,92.107,81.648L92.107,81.648L92.107,81.648z M88.305,61.368c1.34,0.984,1.555,2.811,0.479,4.088 c-1.074,1.266-3.035,1.496-4.391,0.515c-5.141-3.775-8.729-1.448-12.877,1.26c-6.117,4.007-13.141,8.588-25.533,3.686 c-1.576-0.625-2.276-2.326-1.595-3.806c0.696-1.479,2.533-2.161,4.108-1.55c9.223,3.654,14.713,0.063,19.502-3.077 C74.217,58.437,79.553,54.944,88.305,61.368L88.305,61.368L88.305,61.368z" />
                </g>
              </svg>
              <span className="uppercase text-[0.75rem] font-[500] text-red-950 text-center">
                Water <br /> Resistant
              </span>
            </div>
          </div>
          <ProductTabs product={product} />
        </div>
      </div>
      <div
        className="content-container py-16 small:py-32 bg-[#fbf7f45a]"
        data-testid="related-products-container"
      >
        <Suspense fallback={<SkeletonRelatedProducts />}>
          <RelatedProducts product={product} countryCode={countryCode} />
        </Suspense>
      </div>
    </>
  )
}

export default ProductTemplate
